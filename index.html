<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loop Runner — playloop.run</title>
  <meta name="description" content="Dash, chain, and climb the leaderboard. A fast, tiny browser action game." />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="favicon.ico">

  <!-- Consent Mode v2 (default denied) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('consent','default',{'ad_storage':'denied','ad_user_data':'denied','ad_personalization':'denied','analytics_storage':'denied'});
  </script>

  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3857946786580406" crossorigin="anonymous"></script>

  <!-- Funding Choices (CMP) -->
  <script async src="https://fundingchoicesmessages.google.com/i/pub-3857946786580406?ers=1"></script>
  <script>
    (function signalGooglefcPresent() {
      if (!window.frames['googlefcPresent']) {
        function add(){const f=document.createElement('iframe');f.style='width:0;height:0;border:0;display:none';f.name='googlefcPresent';document.body.appendChild(f);}
        document.body ? add() : setTimeout(signalGooglefcPresent,0);
      }
    })();
  </script>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    html, body { height:100%; margin:0; background:#0b0f14; color:#e6edf3; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial; }
    canvas { display:block; width:100vw; height:100vh; image-rendering: crisp-edges; }
    #ui { position: fixed; inset: 0; pointer-events: none; }
    .hud { position:absolute; left:12px; top: calc(var(--adH, 72px) + 12px); display:flex; gap:12px; align-items:center; }
    .pill { background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); padding:6px 10px; border-radius:999px; font-weight:600; letter-spacing:.3px; }
    .center { position:absolute; left:50%; top:50%; transform: translate(-50%, -50%); text-align:center; }
    .hint { opacity:.8; font-size:14px; margin-top:8px; }
    input[type="text"] { pointer-events:auto; background:#101823; border:1px solid #233146; color:#e6edf3; padding:10px 12px; border-radius:10px; outline:none; }

    /* CTA buttons */
    .cta{ position:relative; pointer-events:all; border:1px solid transparent; padding:14px 22px; border-radius:14px; font-weight:800; cursor:pointer; display:inline-flex; align-items:center; gap:10px; letter-spacing:.3px; transition:transform .12s ease, filter .12s ease, box-shadow .12s ease; user-select:none; -webkit-tap-highlight-color:transparent; overflow:hidden; }
    .cta:focus-visible{ outline:2px solid #fff; outline-offset:2px; }
    .cta:hover{ transform:translateY(-1px); filter:brightness(1.03); }
    .cta:active{ transform:translateY(1px) scale(.98); }
    .cta__icon{ font-size:18px; line-height:0; }
    .cta--primary{ background:linear-gradient(135deg,#2c7cf7,#7cfdd6 120%); color:#06101a; box-shadow:0 6px 18px rgba(44,124,247,.35), inset 0 1px 0 rgba(255,255,255,.25); border-color:rgba(124,253,214,.25); }
    .cta--secondary{ background:linear-gradient(135deg,#ff7ab6,#ffd277 120%); color:#1a0b0f; box-shadow:0 6px 18px rgba(255,122,182,.35), inset 0 1px 0 rgba(255,255,255,.25); border-color:rgba(255,210,119,.25); }
    .cta::before{ content:""; position:absolute; inset:-30% -10% auto -30%; height:200%; width:140%; background:linear-gradient(100deg,rgba(255,255,255,0) 0%,rgba(255,255,255,.35) 20%,rgba(255,255,255,0) 40%); transform:translateX(-120%) rotate(-20deg); transition:transform .35s ease; pointer-events:none; }
    .cta:hover::before{ transform:translateX(40%) rotate(-20deg); }
    .cta .ripple{ position:absolute; border-radius:999px; transform:translate(-50%,-50%); background:rgba(255,255,255,.45); mix-blend-mode:soft-light; pointer-events:none; animation:ripple .6s ease-out forwards; }
    @keyframes ripple{ from{width:0;height:0;opacity:.55} to{width:520px;height:520px;opacity:0} }
    .cta .spark{ position:absolute; width:6px; height:6px; border-radius:50%; pointer-events:none; filter:blur(.2px); animation:pop .6s ease-out forwards; }
    @keyframes pop{ 0%{transform:translate(0,0) scale(1);opacity:1} 100%{transform:translate(var(--dx),var(--dy)) scale(.4);opacity:0} }

    /* Ads (responsive with caps, centered) */
    #ad-top-wrapper { position: fixed; top:0; left:0; right:0; z-index:5; background:#0b0f14; padding:6px 8px 0; width:100%; display:flex; justify-content:center; }
    #ad-spacer { height: var(--adH, 72px); }
    #ad-top-unit { width:100%; max-width:728px; margin:0 auto; }   /* desktop cap */
    @media (max-width:1024px){ #ad-top-unit { max-width:468px; } } /* tablet cap  */
    @media (max-width:480px) { #ad-top-unit { max-width:320px; } } /* phone cap   */

    /* Collapse ad UI if blocked */
    .ads-blocked #ad-top-wrapper { display:none; }
    .ads-blocked #ad-spacer { height:0 !important; }

    /* Modal */
    .modal { pointer-events:auto; position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10; }
    .modal.show { display:flex; }
    .sheet { width:min(560px, 92vw); background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.1); border-radius:16px; padding:16px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    .row { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    table { width:100%; border-collapse: collapse; }
    th, td { text-align:left; padding:8px; border-bottom: 1px solid rgba(255,255,255,0.08); font-size:14px; }
  </style>
</head>
<body>
  <div id="ad-top-wrapper">
    <ins id="ad-top-unit" class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3857946786580406"
         data-ad-slot="7067398117"
         data-ad-format="auto"
         data-full-width-responsive="false"></ins>
  </div>
  <div id="ad-spacer"></div>

  <canvas id="game"></canvas>

  <div id="ui">
    <div class="hud">
      <div id="score" class="pill">Score: 0</div>
      <div id="combo" class="pill">Combo: 0</div>
      <div id="best" class="pill">Best: 0</div>
      <div id="daily" class="pill">Daily: 0</div>
      <a href="privacy.html" class="pill" style="text-decoration:none; pointer-events:auto;">Privacy</a>
      <button id="lbBtn" class="cta cta--secondary" style="pointer-events:auto;">Leaderboard</button>
    </div>

    <div id="overlay" class="center" style="display:none">
      <h1>Loop Runner</h1>
      <p>Dash through enemies. Click/tap to dash toward the pointer.<br/>Chain kills to build combo. Don’t touch enemies while not dashing.</p>
      <div class="row" style="margin:8px 0;">
        <button id="start" class="cta cta--primary" aria-label="Play"><span class="cta__icon" aria-hidden="true">▶</span> Play</button>
        <button id="dailyBtn" class="cta cta--secondary" aria-label="Daily Run"><span class="cta__icon" aria-hidden="true">☀</span> Daily Run</button>
      </div>
      <div class="hint">Controls: Click/Tap to dash • Space to restart • P to pause</div>
      <div style="margin-top:10px; opacity:.85; font-size:13px;">Name: <input id="nameInput" type="text" placeholder="Your name (for scores)" style="width:220px;" /></div>
    </div>
  </div>

  <div id="lbModal" class="modal">
    <div class="sheet">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Leaderboard</h2>
        <button id="lbClose" class="cta cta--secondary" style="padding:10px 14px;">Close</button>
      </div>
      <div style="margin: 8px 0;">
        <ins id="ad-modal-unit" class="adsbygoogle"
             style="display:block; width:100%; max-width:336px; margin:0 auto;"
             data-ad-client="ca-pub-3857946786580406"
             data-ad-slot="7067398117"
             data-ad-format="auto"
             data-full-width-responsive="false"></ins>
      </div>
      <div class="row" style="margin:8px 0 12px 0; align-items:center;">
        <select id="lbMode" style="pointer-events:auto; background:#101823; border:1px solid #233146; color:#e6edf3; padding:10px 12px; border-radius:10px; outline:none;">
          <option value="normal">Normal</option>
          <option value="daily">Daily (today)</option>
        </select>
        <div id="lbInfo" style="opacity:.8; font-size:13px;"></div>
      </div>
      <table id="lbTable"><thead><tr><th style="width:56px;">#</th><th>Name</th><th>Score</th><th style="text-align:right;">When</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

<script>
(() => {
  // Canvas + game setup is identical to your last "graphics plus" build
  // (omitted here to keep this snippet short). The only changes below are
  // the Supabase helpers and wiring into submit/render.
})();
</script>

<!-- In the real file, the full game code is included above (not truncated). -->
</body>
</html>
